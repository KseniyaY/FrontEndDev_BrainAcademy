<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Recursion on the example of fibbonachi numbers</title>
</head>
<body>
<script>
////В коде функции могут вызывать другие функции для выполнения подзадач. Частный случай подвызова – когда функция вызывает сама себя. Это называется РЕКУРСИЕЙ.
//Значение, на котором рекурсия заканчивается называют базисом рекурсии. В примерах ниже базисом является 0 и 1 (где, как).
//Общее количество вложенных вызовов называют глубиной рекурсии. В случае с числами Фиббоначи, всего будет n вызовов.
//Максимальная глубина рекурсии в браузерах ограничена, точно можно рассчитывать на 10000 вложенных вызовов, но некоторые интерпретаторы допускают и больше.
//Итак, рекурсию используют, когда вычисление функции можно свести к её более простому вызову, а его – ещё к более простому, и так далее, пока значение не станет очевидно.


//функция, использующая числа Фиббоначи — отличный пример рекурсии, и, вместе с тем, отличный пример того, что рекурсия не самый лучший способ решить задачу. Рекурсия очень прожорлива к ресурсам ПК, поэтому нужно, по возможности, её избегать.
//Числа Фибоначчи — это последовательность чисел, в которой каждое следующее число является суммой двух предыдущих чисел. Начинается последовательность с нуля и единицы (ноль иногда опускают). Выглядит это так:

//0, 1, 1, 2, 3, 5, 8, 13, 21, 34… и так до бесконечности
//рассчитываются по формуле: F0 = 0, F1 = 1, Fn = Fn-1 + Fn-2, n>=2
//Т.е. первые два числа равны 1, а именно:
//F2 = F2-1 (а значит F1, значение которого сразу задано, как 1) + F2-2 (а значит F0, значение которого сразу задано, как 0) = 1 + 0 = 1. Т.е. значение числа в последовательности Фиббоначи по порядковому номеру 2 (n=2);

//F3 = F3-1 (а значит F2, значение которого мы только что вычислил и оно равно 1) + F3-2 (а значит F1, значение которого сразу задано, как 1) = 1 + 1 = 2. Т.е. значение числа в последовательности Фиббоначи по порядковому номеру 3 (n=3);

//затем F4 = 3, а именно F3 + F2 или 2+1,
//F5 = 5, а именно F4 + F3 или 3+2
// и так далее: 8, 13, 21....

//Числа Фибоначчи тесно связаны с золотым сечением и множеством природных явлений вокруг нас.

//Чтобы было легче понять суть данной последовательности, обратимся к истории ее создания.
//На Западе эта последовательность была исследована Леонардо Пизанским, известным как Фибоначчи, в его труде «Liber Abaci» (1202). Он рассматривает развитие идеализированной (биологически нереальной) популяции кроликов, предполагая, что: изначально есть новорожденная пара кроликов (самец и самка); со второго месяца после своего рождения кролики начинают спариваться и каждый месяц производить новую пару кроликов; кролики никогда не умирают. Сколько пар кроликов будет через год?

//В учебниках нам предлагают найти любой член последовательности зная его номер. Т.е., допустим, нам надо найти шестое число в последовательности. Основная формула для нахождения любого числа выглядит так:
//F0 = 0, F1 = 1, Fn = Fn-1 + Fn-2, n>=2

//Пишем функцию, которая запустит вычисление последовательно и по сути будет замкнутой сама на себя пока не достигнет аргумента, указанного при ее вызове

	function fibbonachi(n) {
		if(n===0) return n;
		if(n===1) return n;
		return fibbonachi(n-2)+fibbonachi(n-1);
	}
//Пишем такую же функцию, но с возможностью сохранения промежуточных результатов вычисления по порядковому числу в массив cache, который мы сможем вывести в console или документ, или использовать для других задач в коде.
	var cache = []; //объеявляем переменную для пустого массива за пределами функции
	function fibCache (n) {
		if (cache[n]) return cache[n];
		if (n === 0) {
			cache[n] = n;
			return cache[n] = n;
		}	
		if (n === 1) {
			cache[n] = n;
			return cache[n] = n;
		}	
		return cache[n] = fibCache(n - 2) + fibCache(n - 1);
		}

	document.write(fibCache(6) + "<br>"); // >>> 8 Т.е. значение 6-го по счету числа будет равно 8 (если учесть, что значение 0 - нулевое по счету число). 
	document.write(cache + "<br>");

//Обрати внимание, так как мы захотим узнать значение в последовательности Фиббоначи любого порядкового номера, то мы укажим его в качетсве аргумента для вызова функции и она начнет вычисление с конца, вызывая сама себя.
//Напр., хотим узнать значение порядкового числа 6:
//1. F6 = F5 + F4 => пока значение F5 и F4 неизвестно, функция опускается ниже и ищет
//2. F5 = F4 + F3 => пока значение F4 и F3 неизвестно, функция опускается ниже и ищет
//3. F4 = F3 + F2 => пока значение F3 и F2 неизвестно, функция опускается ниже и ищет
//4. F3 = F2 + F1 => значение F1 известно по предварительному условию и равно 1, но пока значение F2 неизвестно, функция опускается ниже и ищет
//5. F2 = F1 + F0, здесь согласно предварительным условиям известны оба значения, равные 1 и 0 соответственно = 1,

//А значит функция располагая двумя значениями 1 и 0, может снова подняться выше и подставлять их сумму 1 в саму себя по индексу 3:
//6. F3 = 1 + 1 = 2;
//7. F4 = 2 + 1 = 3;
//8. F5 = 3 + 2 = 5;
//9. F6 = 5 + 3 = 8
//на 9-м шаге функция вернула значение 8 для порядкового числа 6 и может остановится.
//В ЭТОМ И СОСТОИТ РЕКУРСИЯ

	//Или еще один пример описания функции Фиббоначи с использованием условного выражения if. 

	function fibonacci(n) {
	  	if (n<3)
        	return 1;
    	else
        	return fibonacci(n-1) + fibonacci(n-2);
    }

    //Запускаем цикл for, через который собственно и вызываем функцию расчета значения порядкового числа в последовательности Фибонначи, в то время как порядковое число задается переменной i из цикла:
    var i;
	for (i = 1; i <= 6; i++) {
    	document.write(fibonacci(i) + ", "); //вывод значения порядкового элемента в последовательности Фиббоначи по каждой итерации цикла сразу в HTML документ, без использования функции сохранения промежуточных вычислений в массив
	}
	document.write("...<br>");


	//Итак, всё хорошо, функция отлично находит шестое число в последовательности. Но это только пока… Я не знаю насколько мощный у вас ПК, но попробуйте найти пятидесятое число:
	document.write(fibCache(77) + "<br>");
	//Уверяю вас, комп ощутимо задумается, если не повиснет в принципе.
	// document.write(cache);

	//Итак, как мы уже сказали, Рекурсия очень прожорлива к ресурсам компа, поэтому нужно, по возможности, её избегать. 
	//Но как же нам найти любое число в последовательности Фибоначчи? Лезем в википедию и узнаём, что нам на помощь приходит формула Бине:
	//document.write("https://upload.wikimedia.org/wikipedia/ru/math/4/5/4/454572f96eda3d8f8362ecb40b7dfbb8.png");
	//расписываем ее в нашей новой более эффективной функции:
	function fibonacci2(n) {
  		var sq5 = Math.sqrt(5); // сохраняем  переменную sq5 значение корня из 5, чтобы сэкономить ресурсы
  		var a = (1 + sq5) / 2; //сохраняем расчет в переменную a
  		var b = (1 - sq5) / 2; //сохраняем расчет в переменную b
  		return (Math.pow(a, n) - Math.pow(b, n)) / sq5; //указываем функции, что 
	}

	document.write(fibonacci2(500) + "<br>"); // >>> 1.3942322456169767e+104


	
	

</script>
	
</body>
</html>